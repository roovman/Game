# PLAN.md: Наступна Сесія (Select & Act)

**Поточний Стан:** Реалізовано повну FSM-архітектуру (`Menu` ↔ `Editor` ↔ `Simulation`) та чисте розділення обов'язків між пасивним ядром (`GameState`) та активними контролерами (`EditorMode`/`GameMode`).
**Основна Мета:** Завершення логіки тактичного керування юнітами та підготовка ядра до роботи зі складнішими об'єктами (поліморфізм).

---

## Фаза 1: Фіналізація FSM та Передача Стану

### Передача Світу (Editor → Simulation)
* **Логіка Переходу:** Реалізувати логіку, де `ApplicationState::apply_action` витягує оновлений `GameState` з `EditorMode` і передає його до `GameMode::new()` при натисканні відповідної кнопки в редакторі (наприклад, **Enter** або спеціалізована кнопка "Start Simulation").
* **Верифікація:** Цей крок остаточно доводить гнучкість нашої архітектури.

### Фіналізація "Q" в Режимах
* **Action::BackToMenu:** Переконатися, що `Action::BackToMenu` (клавіша **Q**) у режимах `Editor` та `Simulation` завжди коректно переводить додаток назад до `AppState::Menu`.

### Управління Курсором
* **Візуалізація:** Додати логіку відображення курсора миші на карті (наприклад, інвертування кольору клітинки або підсвічування), щоб користувач завжди знав, куди він цілиться.
* **Обробка Вводу:** Оновити `handle_input` для коректної обробки подій `MouseMove`.

---

## Фаза 2: Core Gameplay Logic (Select & Act)

### Логіка Руху
* **Обмеження Дальності:** Фіналізувати `GameMode::try_move_entity` для введення обмежень на дальність руху (наприклад, до **5 клітинок** від початкової позиції), оскільки наразі рух необмежений.

### Логіка Вибору
* **Візуальний Фідбек:** Забезпечити, що коли сутність вибрана, вона отримує чіткий візуальний фідбек (наприклад, встановлення `entity.is_selected = true`), який коректно відображається у функції `draw_map_tiles`.

### Логіка Атаки (Foundation)
* **Бойова Взаємодія:** Реалізувати гілку `handle_click` у `GameMode` таким чином, щоб клік на **іншу** сутність (ворога) призводив до **атаки**, а не руху. Це має супроводжуватися зменшенням HP цільової сутності, вводячи першу бойову взаємодію.

---

## Фаза 3: Об'єкти та UI/UX (Запорука SimCity)

### Уніфікація ID
* **Типізація:** Фіналізувати та перевірити, що всі ідентифікатори об'єктів (`TileID`, `EntityID`, а також посилання на них у `GameState`) використовують єдиний тип **`u32`** у всій кодовій базі.

### Візуалізація Панелі Статусу
* **Інформативність UI:** Покращити `draw_status_panel`, щоб вона відображала стан здоров'я (HP) вибраного юніта та його координати більш наочно. Рекомендується використання **кольорового градієнту** для HP (зелений → червоний).

### Основа AI (Трейти)
* **Поліморфізм:** Створити файл `src/specials/ai.rs` з простим **`Trait AI`** (як ми обговорювали). Це продемонструє, як ваша архітектура на **Rust** готова до поліморфізму та легкого додавання ворогів/складніших NPC-поведінок.z